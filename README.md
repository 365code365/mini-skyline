# Mini App Engine

ç±»ä¼¼å¾®ä¿¡å°ç¨‹åºçš„è½»é‡çº§è¿è¡Œæ—¶å¼•æ“ï¼ŒåŒ…å«ï¼š
- ğŸ¨ 2D æ¸²æŸ“å¼•æ“ï¼ˆç±»ä¼¼ Skiaï¼‰
- âš¡ QuickJS è„šæœ¬å¼•æ“
- ğŸ§© UI ç»„ä»¶ç³»ç»Ÿ
- ğŸ“± äº‹ä»¶å¤„ç†ç³»ç»Ÿ
- ğŸ“„ WXML/WXSS è§£æå™¨
- ğŸ”— C FFI æ¥å£

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Mini App                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              JavaScript (QuickJS)         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚   App   â”‚  â”‚  Page   â”‚  â”‚Component â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â†• Bridge                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Native (Rust)                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ Canvas  â”‚  â”‚   UI    â”‚  â”‚  Event   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Render  â”‚  â”‚ System  â”‚  â”‚  System  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  WXML   â”‚  â”‚  WXSS   â”‚  â”‚ Template â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Parser  â”‚  â”‚ Parser  â”‚  â”‚  Engine  â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                      â†• FFI                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Host Application                â”‚   â”‚
â”‚  â”‚      (iOS / Android / Desktop / Web)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½

### æ¸²æŸ“å¼•æ“
- åŸºæœ¬å›¾å½¢ï¼šçŸ©å½¢ã€åœ†å½¢ã€çº¿æ®µã€æ¤­åœ†
- è·¯å¾„ç»˜åˆ¶ï¼šè´å¡å°”æ›²çº¿ã€åœ†è§’çŸ©å½¢
- æŠ—é”¯é½¿æ¸²æŸ“
- Alpha æ··åˆ
- çœŸå®å­—ä½“æ¸²æŸ“ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
- PNG å¯¼å‡º

### WXML/WXSS è§£æ
- WXML æ¨¡æ¿è§£æï¼ˆæ”¯æŒ `wx:for`ã€`wx:if`ã€`wx:else`ï¼‰
- WXSS æ ·å¼è§£æï¼ˆæ”¯æŒ rpx å•ä½ï¼‰
- æ•°æ®ç»‘å®šï¼ˆ`{{expression}}`ï¼‰
- äº‹ä»¶ç»‘å®šï¼ˆ`bindtap`ã€`catchtap` ç­‰ï¼‰
- æ ·å¼è§£æå™¨ï¼ˆæ”¯æŒ flexbox å¸ƒå±€å±æ€§ï¼‰

### UI ç»„ä»¶
- View - åŸºç¡€å®¹å™¨
- Text - æ–‡æœ¬æ˜¾ç¤º
- Button - æŒ‰é’®
- Image - å›¾ç‰‡
- Input - è¾“å…¥æ¡†
- ScrollView - æ»šåŠ¨å®¹å™¨
- Layout - Flex å¸ƒå±€

### JS APIï¼ˆå…¼å®¹å¾®ä¿¡å°ç¨‹åºï¼‰
- `App()` / `Page()` - åº”ç”¨å’Œé¡µé¢å®šä¹‰
- `Page.setData()` - æ•°æ®æ›´æ–°
- `wx.setStorage` / `wx.getStorage` - æœ¬åœ°å­˜å‚¨
- `wx.showToast` / `wx.showModal` - UI åé¦ˆ
- `wx.navigateTo` / `wx.navigateBack` - é¡µé¢å¯¼èˆª
- `wx.createCanvasContext` - Canvas ç»‘åˆ¶
- `setTimeout` / `setInterval` - å®šæ—¶å™¨
- `console.log` - æ§åˆ¶å°è¾“å‡º

## å®‰è£…

```bash
# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# æ„å»º
cd mini-render
cargo build --release
```

## è¿è¡Œç¤ºä¾‹

```bash
# è¿è¡Œä¸»ç¨‹åº
cargo run --bin mini-app

# è¿è¡Œæ¸²æŸ“ç¤ºä¾‹
cargo run --example demo

# è¿è¡Œçª—å£ç¤ºä¾‹
cargo run --example mini_app_window
```

## é¡¹ç›®ç»“æ„

```
mini-render/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£
â”‚   â”œâ”€â”€ canvas.rs           # ç”»å¸ƒæ ¸å¿ƒ
â”‚   â”œâ”€â”€ color.rs            # é¢œè‰²å¤„ç†
â”‚   â”œâ”€â”€ geometry.rs         # å‡ ä½•å›¾å½¢
â”‚   â”œâ”€â”€ paint.rs            # ç”»ç¬”
â”‚   â”œâ”€â”€ path.rs             # è·¯å¾„
â”‚   â”œâ”€â”€ text.rs             # æ–‡æœ¬æ¸²æŸ“
â”‚   â”œâ”€â”€ ffi.rs              # C FFI
â”‚   â”œâ”€â”€ event.rs            # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ui/                 # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ component.rs    # ç»„ä»¶åŸºç±»
â”‚   â”‚   â”œâ”€â”€ view.rs         # View
â”‚   â”‚   â”œâ”€â”€ button.rs       # Button
â”‚   â”‚   â”œâ”€â”€ image.rs        # Image
â”‚   â”‚   â”œâ”€â”€ scroll_view.rs  # ScrollView
â”‚   â”‚   â””â”€â”€ layout.rs       # Layout
â”‚   â”œâ”€â”€ js/                 # JS å¼•æ“
â”‚   â”‚   â”œâ”€â”€ runtime.rs      # QuickJS è¿è¡Œæ—¶
â”‚   â”‚   â”œâ”€â”€ api.rs          # å°ç¨‹åº API
â”‚   â”‚   â””â”€â”€ bridge.rs       # JS-Native æ¡¥æ¥
â”‚   â”œâ”€â”€ parser/             # è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ wxml.rs         # WXML è§£æå™¨
â”‚   â”‚   â”œâ”€â”€ wxss.rs         # WXSS è§£æå™¨
â”‚   â”‚   â””â”€â”€ template.rs     # æ¨¡æ¿å¼•æ“
â”‚   â”œâ”€â”€ renderer/           # æ¸²æŸ“å™¨
â”‚   â”‚   â”œâ”€â”€ wxml_renderer.rs    # WXML æ¸²æŸ“å™¨
â”‚   â”‚   â””â”€â”€ style_resolver.rs   # æ ·å¼è§£æå™¨
â”‚   â”œâ”€â”€ runtime/            # åº”ç”¨è¿è¡Œæ—¶
â”‚   â”‚   â”œâ”€â”€ app.rs          # MiniApp
â”‚   â”‚   â””â”€â”€ window.rs       # çª—å£ç®¡ç†
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ main.rs         # ä¸»ç¨‹åº
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ NotoSansSC-Regular.ttf  # ä¸­æ–‡å­—ä½“
â”œâ”€â”€ include/
â”‚   â””â”€â”€ mini_render.h       # C å¤´æ–‡ä»¶
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ demo.rs             # æ¸²æŸ“ç¤ºä¾‹
â”‚   â”œâ”€â”€ demo.c              # C ç¤ºä¾‹
â”‚   â””â”€â”€ mini_app_window.rs  # çª—å£ç¤ºä¾‹
â””â”€â”€ sample-app/             # ç¤ºä¾‹å°ç¨‹åº
    â”œâ”€â”€ app.js
    â”œâ”€â”€ app.json
    â””â”€â”€ pages/
        â””â”€â”€ index/
            â”œâ”€â”€ index.js    # é¡µé¢é€»è¾‘
            â”œâ”€â”€ index.wxml  # é¡µé¢æ¨¡æ¿
            â””â”€â”€ index.wxss  # é¡µé¢æ ·å¼
```

## C/C++ é›†æˆ

```c
#include "mini_render.h"

// åˆ›å»ºç”»å¸ƒ
Canvas* canvas = mr_canvas_new(375, 667);
mr_canvas_clear(canvas, 255, 255, 255, 255);

// ç»˜åˆ¶
mr_canvas_draw_rect(canvas, 10, 10, 100, 50, 0x4A, 0x90, 0xD9, 255, 0, 0);
mr_canvas_draw_circle(canvas, 200, 100, 30, 0xE7, 0x4C, 0x3C, 255, 0, 0);

// ä¿å­˜
mr_canvas_save_png(canvas, "output.png");
mr_canvas_free(canvas);
```

## ç¼–è¯‘åŠ¨æ€åº“

```bash
cargo build --release

# macOS: target/release/libmini_render.dylib
# Linux: target/release/libmini_render.so
# Windows: target/release/mini_render.dll
```

## License

MIT
